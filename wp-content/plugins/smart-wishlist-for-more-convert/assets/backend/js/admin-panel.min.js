"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}jQuery(function(l){function n(e,t,a){l.ajax({url:wlfmc_wishlist_admin.ajax_url,data:{action:e,key:wlfmc_wishlist_admin.ajax_nonce,attachment_id:a.parent().find("input").val(),offset:t},method:"post",beforeSend:function(){a.addClass("loading")},success:function(t){t.success?(a.text(t.data.percentage+"%"),100<=parseInt(t.data.percentage)?setTimeout(function(){a.text(a.data("label")),a.removeClass("loading"),a.prop("disabled",!1),s(t.data.message)},2e3):n(e,parseInt(t.data.offset),a)):(a.text(a.data("label")),a.removeClass("loading"),a.prop("disabled",!1),s(t.data.message))}}).fail(function(t){a.removeClass("loading"),window.console.log(t)})}function i(e,t,a){l.ajax({url:wlfmc_wishlist_admin.ajax_url,data:{action:e,key:wlfmc_wishlist_admin.ajax_nonce,offset:t},method:"post",beforeSend:function(){a.addClass("loading")},success:function(t){t.success?(a.text(t.data.percentage+"%"),100<=parseInt(t.data.percentage)?setTimeout(function(){a.text(a.data("label")),a.removeClass("loading"),a.prop("disabled",!1),s(t.data.message)},2e3):i(e,parseInt(t.data.offset),a)):(a.text(a.data("label")),a.removeClass("loading"),a.prop("disabled",!1),s(t.data.message))}}).fail(function(t){a.removeClass("loading"),window.console.log(t)})}(function(){l("select#discount-type").on("change",function(){var t=l(this).val(),e=l("#coupon-amount");"percent"===t?(e.removeClass("wc_input_price").addClass("wc_input_decimal"),e.siblings(".description").text(wlfmc_wishlist_admin.i18n_percent_description)):(e.removeClass("wc_input_decimal").addClass("wc_input_price"),e.siblings(".description").text(wlfmc_wishlist_admin.i18n_amount_description))}).trigger("change")})();function e(a,t){"undefined"!=typeof tinyMCE&&tinyMCE.triggerSave(!0,!0);t={action:t,key:wlfmc_wishlist_admin.ajax_nonce,options:l("form#wlfmc_automation_options_form").serialize()};l.ajax({url:wlfmc_wishlist_admin.ajax_url,data:t,type:"POST",beforeSend:function(){a.addClass("loading")},complete:function(){a.removeClass("loading")},success:function(t){var e;!0===t.status?o(t.errors,"mct-updated"):!0===t.show_pro_popup?(e=a.data("modal"),l("#"+e).removeAttr("style").toggleClass("is-visible")):o(t.errors,"mct-error"),t.url&&""!==t.url&&(window.location.href=t.url)}})}l(document.body).on("click",".wlfmc-import-by-csv .mct_action_file_button",function(t){var e=l(this);return t.preventDefault(),n(e.closest(".wlfmc-import-by-csv").data("action"),0,e),!1}),l(document.body).on("click",".wlfmc-import-by-action",function(t){var e=l(this);return t.preventDefault(),i(e.data("action"),0,e),!1}),l(document.body).on("change",".wc_input_price[type=text], .wc_input_decimal[type=text]",function(){var t,e=wlfmc_wishlist_admin.decimal_point,a=(l(this).is(".wc_input_price")&&(e=wlfmc_wishlist_admin.mon_decimal_point),n=new RegExp("[^-0-9%\\"+e+"]+","gi"),t=new RegExp("\\"+e+"+","gi"),l(this).val()),n=a.replace(n,"").replace(t,e);a!==n&&l(this).val(n)}).on("keyup",".wc_input_price[type=text], .wc_input_decimal[type=text]",function(){var t,e=!1,a=l(this).is(".wc_input_price")?(e=!0,i=new RegExp("[^-0-9%\\"+wlfmc_wishlist_admin.mon_decimal_point+"]+","gi"),t=new RegExp("[^\\"+wlfmc_wishlist_admin.mon_decimal_point+"]","gi"),wlfmc_wishlist_admin.i18n_mon_decimal_error):(e=!0,i=new RegExp("[^-0-9%\\"+wlfmc_wishlist_admin.decimal_point+"]+","gi"),t=new RegExp("[^\\"+wlfmc_wishlist_admin.decimal_point+"]","gi"),wlfmc_wishlist_admin.i18n_decimal_error),n=l(this).val(),i=n.replace(i,"");n!==(i=e&&1<i.replace(t,"").length?i.replace(t,""):i)&&s(a)}),l(document.body).on("change","#sfl_enable",function(t){l(this).is(":checked")?(l(".nav-tab-wrapper.mct-tabs a[href='#button']").show(),l(".nav-tab-wrapper.mct-tabs a[href='#page-settings']").show()):(l(".nav-tab-wrapper.mct-tabs a[href='#button']").hide(),l(".nav-tab-wrapper.mct-tabs a[href='#page-settings']").hide())}).trigger("change"),l(document.body).on("change","#multi_list_enable",function(t){l(this).is(":checked")?(l(".nav-tab-wrapper.mct-tabs a[href='#button']").show(),l(".nav-tab-wrapper.mct-tabs a[href='#lists']").show(),l(".nav-tab-wrapper.mct-tabs a[href='#single-list']").show(),l(".nav-tab-wrapper.mct-tabs a[href='#counter']").show()):(l(".nav-tab-wrapper.mct-tabs a[href='#button']").hide(),l(".nav-tab-wrapper.mct-tabs a[href='#lists']").hide(),l(".nav-tab-wrapper.mct-tabs a[href='#single-list']").hide(),l(".nav-tab-wrapper.mct-tabs a[href='#counter']").hide())}).trigger("change"),l(document.body).on("change","#wishlist_enable",function(t){l(this).is(":checked")?(l(".nav-tab-wrapper.mct-tabs a[href='#button']").show(),l(".nav-tab-wrapper.mct-tabs a[href='#page-settings']").show(),l(".nav-tab-wrapper.mct-tabs a[href='#counter']").show()):(l(".nav-tab-wrapper.mct-tabs a[href='#button']").hide(),l(".nav-tab-wrapper.mct-tabs a[href='#page-settings']").hide(),l(".nav-tab-wrapper.mct-tabs a[href='#counter']").hide())}).trigger("change"),l(document.body).on("change","#waitlist_enable",function(t){l(this).is(":checked")?(l(".nav-tab-wrapper.mct-tabs a[href='#button']").show(),l(".nav-tab-wrapper.mct-tabs a[href='#page-settings']").show(),l(".nav-tab-wrapper.mct-tabs a[href='#counter']").show()):(l(".nav-tab-wrapper.mct-tabs a[href='#button']").hide(),l(".nav-tab-wrapper.mct-tabs a[href='#page-settings']").hide(),l(".nav-tab-wrapper.mct-tabs a[href='#counter']").hide())}).trigger("change"),l(document.body).on("change","select#sfl_button_position",function(t){"with_remove_icon"===l(this).val()?(l("#sfl_button_type_text").attr("disabled",!0),l("#sfl_button_type_both").attr("disabled",!0),l("#sfl_button_type_icon").prop("checked",!0),l(".row-sfl_button_type").hide()):(l("#sfl_button_type_text").removeAttr("disabled"),l("#sfl_button_type_both").removeAttr("disabled"),l(".row-sfl_button_type").show())}),l(document.body).on("click",".wlfmc-built-wishlist-page:not(.disabled)",function(t){t.preventDefault();var e=l(this),a=e.text();return e.addClass("disabled"),e.text(wlfmc_wishlist_admin.i18n_making_page),l.ajax({url:wlfmc_wishlist_admin.ajax_url,data:{action:"wlfmc_create_wishlist_page",key:wlfmc_wishlist_admin.ajax_nonce},dataType:"json",method:"POST",success:function(t){t&&t.success&&location.reload(!0)},error:function(){console.log("We cant create page. Something wrong with AJAX response. Probably some PHP conflict.")},complete:function(){e.removeClass("disabled"),e.text(a)}}),!1}),l(document.body).on("click",".wlfmc-built-waitlist-page:not(.disabled)",function(t){t.preventDefault();var e=l(this),a=e.text();return e.addClass("disabled"),e.text(wlfmc_wishlist_admin.i18n_making_page),l.ajax({url:wlfmc_wishlist_admin.ajax_url,data:{action:"wlfmc_create_waitlist_page",key:wlfmc_wishlist_admin.ajax_nonce},dataType:"json",method:"POST",success:function(t){t&&t.success&&location.reload(!0)},error:function(){console.log("We cant create page. Something wrong with AJAX response. Probably some PHP conflict.")},complete:function(){e.removeClass("disabled"),e.text(a)}}),!1}),l(document.body).on("click",".wlfmc-built-lists-page:not(.disabled)",function(t){t.preventDefault();var e=l(this),a=e.text();return e.addClass("disabled"),e.text(wlfmc_wishlist_admin.i18n_making_page),l.ajax({url:wlfmc_wishlist_admin.ajax_url,data:{action:"wlfmc_create_lists_page",key:wlfmc_wishlist_admin.ajax_nonce},dataType:"json",method:"POST",success:function(t){t&&t.success&&location.reload(!0)},error:function(){console.log("We cant create page. Something wrong with AJAX response. Probably some PHP conflict.")},complete:function(){e.removeClass("disabled"),e.text(a)}}),!1}),l(document.body).on("click",".wlfmc-built-tabbed-page:not(.disabled)",function(t){t.preventDefault();var e=l(this),a=e.text();return e.addClass("disabled"),e.text(wlfmc_wishlist_admin.i18n_making_page),l.ajax({url:wlfmc_wishlist_admin.ajax_url,data:{action:"wlfmc_create_tabbed_page",key:wlfmc_wishlist_admin.ajax_nonce},dataType:"json",method:"POST",success:function(t){t&&t.success&&location.reload(!0)},error:function(){console.log("We cant create page. Something wrong with AJAX response. Probably some PHP conflict.")},complete:function(){e.removeClass("disabled"),e.text(a)}}),!1}),l(document).on("wlfmc_automation_init",function(){var t=l(this);t.on("click",".save-automation",function(t){return t.preventDefault(),e(l(this),"wlfmc_save_automation"),!1}),t.on("click",".new-automation",function(t){return t.preventDefault(),e(l(this),"wlfmc_new_automation"),!1}),t.on("change","form#wlfmc_automation_options_form :input",function(){l(".ajax-message-holder").html("")}),t.on("click",".wlfmc-send-offer-email-test",function(t){t.preventDefault();var e=l(this),a=e.text();return e.addClass("disabled"),e.text(wlfmc_wishlist_admin.i18n_sending),l.ajax({url:wlfmc_wishlist_admin.ajax_url,data:{id:e.data("id"),automation_id:l("#automation_id").val(),action:"wlfmc_send_offer_email_test",key:wlfmc_wishlist_admin.ajax_nonce},dataType:"json",method:"POST",success:function(t){t&&t.message&&s(t.message)},error:function(){console.log("We cant Send email. Something wrong with AJAX response. Probably some PHP conflict.")},complete:function(){e.removeClass("disabled"),e.text(a)}}),!1}),t.on("click",".wlfmc-reset-sending-cycles",function(t){t.preventDefault();var e=l(this),a=e.text();return confirm(wlfmc_wishlist_admin.i18n_resetting_confirm)&&(e.addClass("disabled"),e.text(wlfmc_wishlist_admin.i18n_resetting),l.ajax({url:wlfmc_wishlist_admin.ajax_url,data:{action:"wlfmc_reset_sending_cycles_automation",key:wlfmc_wishlist_admin.ajax_nonce},dataType:"json",method:"POST",success:function(t){t&&t.message&&s(t.message)},error:function(){console.log("We cant Send email. Something wrong with AJAX response. Probably some PHP conflict.")},complete:function(){e.removeClass("disabled"),e.text(a)}})),!1})}).trigger("wlfmc_automation_init");var r=null;function o(t,e){var a=l(".ajax-message-holder .mct-message"),n="";Array.isArray(t)?l.each(t,function(t,e){n+=""!==e?"<li>"+e+"</li>":""}):n+=""!==t?"<li>"+t+"</li>":"",""!==n&&(a.length||l(".ajax-message-holder").append('<div  class="mct-message '+e+'"><ul></ul></div>'),l(".ajax-message-holder .mct-message").find("ul").html(n),l("html, body").animate({scrollTop:0},"slow"))}function s(t){var e=document.getElementById("snackbar");e.innerHTML=t,e.className="show",setTimeout(function(){e.className=e.className.replace("show","")},3e3)}l(document).on("change","#wlfmc_automation_options_form",function(t){t.preventDefault();var a,n,e,i,t=l(".preview_iframe_wrapper:visible"),o=l(".mail_heading:visible").val(),s=l("#mail-type").val(),c=l("#offer_emails .manage-row.is-current .wlfmc-send-offer-email-test").data("id");return void 0!==c&&(e="plain"===s?l(".text_content:visible").val():"undefined"!=typeof tinyMCE&&tinyMCE.get("offer_emails_"+c+"__html_content_")?tinyMCE.get("offer_emails_"+c+"__html_content_").getContent():l("#offer_emails_"+c+"__html_content_").val(),c="plain"===s?l(".text_footer:visible").val():"undefined"!=typeof tinyMCE&&tinyMCE.get("offer_emails_"+c+"__html_footer_")?tinyMCE.get("offer_emails_"+c+"__html_footer_").getContent():l("#offer_emails_"+c+"__html_footer_").val(),t.length&&(a=t,n=s,t=o,s=e,o=c,e=l(this),r&&r.abort(),i=new FormData,t={action:"wlfmc_preview_automation_template",key:wlfmc_wishlist_admin.ajax_nonce,template:n,heading:t,content:s,footer:o},(e||0<e.length)&&(i=new FormData(e.get(0))),l.each(t,function(t,e){i.append(t,"object"===_typeof(e)?JSON.stringify(e):e)}),r=l.ajax({url:wlfmc_wishlist_admin.ajax_url,contentType:!1,processData:!1,cache:!1,data:i,method:"POST",beforeSend:function(){a.closest(".mct-column").addClass("block-loading")},complete:function(){a.closest(".mct-column").removeClass("block-loading")},success:function(t){var t=t.data,e=a[0].contentDocument;e.open(),e.write(t.html),e.close(),"html"===n&&l(e).contents().find("#wrapper > table").removeAttr("height")}}))),!1}),l("#wlfmc_automation_options_form").length&&(setTimeout(function(){for(var t=tinymce.editors.length,e=0;e<t;e++)tinymce.editors[e].on("input-dirty keyup change",function(){l("#wlfmc_automation_options_form").trigger("change")})},2e3),l(document).on("changed-manage-item",function(t){l("#wlfmc_automation_options_form").trigger("change")}))});